<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Leaflet Google Satellite with Screenshot</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
    #btn {
      margin: 10px;
      padding: 8px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #btn[disabled] {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <button id="btn">Save Screenshot</button>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-simple-map-screenshoter/dist/leaflet-simple-map-screenshoter.js"></script>

  <script>
    // Initialize map
    const map = L.map("map").setView([33.6844, 73.0479], 13); // Islamabad coords

    // Google Satellite tiles (unofficial URL)
    L.tileLayer("http://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}", {
      attribution: "Google Satellite",
      maxZoom: 20
    }).addTo(map);

    // Add the screenshoter control
    const screenshoter = L.simpleMapScreenshoter().addTo(map);

    // Restore Save Screenshot button functionality so users can
    // use either the floating icon or this button to take screenshots.
    document.getElementById("btn").addEventListener("click", () => {
      screenshoter.takeScreen("image").then(blob => {
        try {
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `map-screenshot-${Date.now()}.png`;
          document.body.appendChild(link);
          link.click();
          link.remove();
          URL.revokeObjectURL(url);
        } catch (err) {
          console.error('Download failed:', err);
        }
      }).catch(err => {
        console.error('Screenshoter error:', err);
        alert('Failed to take screenshot: ' + (err && err.message ? err.message : err));
      });
    });
  </script>
</body>
</html>
